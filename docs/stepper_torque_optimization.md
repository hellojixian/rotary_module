# 28BYJ-48 步进电机扭矩优化指南

## 扭矩不足的原因分析

28BYJ-48是一款小型步进电机，本身扭矩较小。扭矩不足可能由以下原因造成：

1. **电流不足** - 线圈电流太小
2. **步进模式** - 半步模式扭矩比全步模式小
3. **速度过快** - 高速时扭矩下降
4. **电源电压** - 电压不稳定或过低
5. **机械负载** - 负载超过电机额定扭矩

## 扭矩优化方案

### 方案1: 切换到全步模式（推荐）

全步模式比半步模式扭矩更大，让我们修改步进序列：

```cpp
// 在stepper_motor.cpp中替换步进序列
// 原来的8步半步序列
static const uint8_t step_sequence_half[8] = {
    0b0001, 0b0011, 0b0010, 0b0110,
    0b0100, 0b1100, 0b1000, 0b1001
};

// 新的4步全步序列（扭矩更大）
static const uint8_t step_sequence_full[4] = {
    0b0011,  // 线圈1+2同时通电
    0b0110,  // 线圈2+3同时通电
    0b1100,  // 线圈3+4同时通电
    0b1001   // 线圈4+1同时通电
};
```

### 方案2: 双线圈激励模式

同时激励两个线圈可以显著提升扭矩：

```cpp
// 双线圈激励序列（扭矩最大）
static const uint8_t step_sequence_dual[4] = {
    0b0011,  // 线圈1+2
    0b0110,  // 线圈2+3  
    0b1100,  // 线圈3+4
    0b1001   // 线圈4+1
};
```

### 方案3: 降低转速

低速时扭矩更大，可以进一步降低速度：

```cpp
// 修改速度延时配置
static const unsigned long speed_delays[] = {
    5000,  // SPEED_LOW: 5ms延时（更低速，扭矩更大）
    2000   // SPEED_HIGH: 2ms延时
};
```

### 方案4: 电源优化

确保电源能提供足够的电流：
- 使用5V/1A以上的电源适配器
- 添加电源滤波电容（1000μF）
- 检查电源线是否过细

## 实现扭矩优化

已经实现了以下扭矩优化功能：

### 1. 全步模式（默认启用）
```cpp
// 驱动默认使用全步模式，扭矩比半步模式大约提升40%
stepper_motor_init();  // 自动启用全步高扭矩模式
```

### 2. 手动切换步进模式
```cpp
// 切换到全步模式（高扭矩）
stepper_motor_set_step_mode(STEP_MODE_FULL);

// 切换到半步模式（平滑）
stepper_motor_set_step_mode(STEP_MODE_HALF);
```

### 3. 高扭矩模式控制
```cpp
// 启用高扭矩模式
stepper_motor_enable_high_torque();

// 禁用高扭矩模式
stepper_motor_disable_high_torque();
```

### 4. 优化的速度配置
```cpp
// 降低了转速以提升扭矩
SPEED_LOW:  5ms延时 (200步/秒，扭矩最大)
SPEED_HIGH: 2ms延时 (500步/秒，平衡扭矩和速度)
```

## 扭矩提升效果

### 理论提升
- **全步模式 vs 半步模式**: 扭矩提升约40%
- **双线圈激励**: 同时激励两个线圈，扭矩最大化
- **降低速度**: 低速时扭矩可提升60-80%

### 实际测试建议
1. **负载测试**: 测试能驱动的最大负载
2. **保持扭矩**: 测试静止时的保持力
3. **启动扭矩**: 测试从静止启动的能力

## 进一步优化建议

### 硬件优化
1. **电源升级**: 使用5V/2A电源适配器
2. **电容滤波**: 在电源端添加1000μF电容
3. **散热**: 为ULN2003APG添加散热片
4. **线材**: 使用更粗的连接线减少压降

### 软件优化
1. **微步控制**: 实现更精细的电流控制
2. **加速曲线**: 实现平滑的加速减速
3. **电流调节**: 根据负载动态调节电流

### 机械优化
1. **减速器**: 添加齿轮减速器提升扭矩
2. **联轴器**: 使用柔性联轴器减少冲击
3. **轴承**: 减少机械摩擦

## 使用示例

### 高扭矩启动示例
```cpp
void high_torque_start() {
    // 启用高扭矩模式
    stepper_motor_enable_high_torque();
    
    // 设置低速（最大扭矩）
    stepper_motor_set_speed(SPEED_LOW);
    
    // 启动电机
    stepper_motor_start();
    
    Serial.println("High torque mode activated");
}
```

### 精确定位示例
```cpp
void precise_positioning() {
    // 启用高扭矩模式确保精确定位
    stepper_motor_enable_high_torque();
    
    // 精确转动90度
    stepper_motor_rotate_angle(90.0);
    
    // 等待完成
    while (stepper_motor_is_running()) {
        stepper_motor_update();
        delay(10);
    }
    
    Serial.println("Precise positioning completed");
}
```

## 注意事项

### 功耗增加
- 全步模式功耗比半步模式高约30%
- 高扭矩模式会增加发热
- 建议间歇使用以避免过热

### 噪音增加
- 全步模式噪音比半步模式大
- 可通过降低速度减少噪音
- 添加机械阻尼可减少振动

### 精度权衡
- 全步模式精度为半步模式的一半
- 每步角度: 全步0.35° vs 半步0.176°
- 根据应用需求选择合适模式

## 故障排除

### 扭矩仍然不足
1. 检查电源电压和电流
2. 确认负载是否超过电机额定扭矩
3. 检查机械连接是否有卡滞
4. 考虑使用更大扭矩的步进电机

### 电机过热
1. 降低运行速度
2. 增加散热措施
3. 间歇运行避免连续工作
4. 检查电源电流是否过大

### 运行不稳定
1. 检查电源稳定性
2. 确认步进序列正确
3. 检查引脚连接
4. 降低运行速度

通过以上优化措施，28BYJ-48步进电机的扭矩可以得到显著提升，满足更多应用场景的需求。
